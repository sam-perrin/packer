{
    "variables": {
        "iso_name": "CentOS-7-x86_64-Minimal-2003.iso",
        "iso_checksum": "659691c28a0e672558b003d223f83938f254b39875ee7559d1a4a14c79173193",
        "iso_checksum_type": "sha256",
        "ssh_name": "root",
        "ssh_pass": "deploy",
        "vm_name": "CentOS7-template",
        "kickstart": "ks.cfg",
        "num_cpus": "2",
        "mem_size": "4096",
        "disk_size": "20480",
        "vcenter_server": "vcenter",
        "username": "administrator@vsphere.local",
        "password": "VMware123!",
        "datastore": "vsanDatastore",
        "folder": "Templates",
        "host": "esxihost",
        "cluster": "workercluster",
        "network": "VM Network",
        "http_directory": "../http"
    },
    "builders": [
        {
            "type": "vsphere-iso",
            "name": "{{user `vm_name`}}",
            "boot_wait": "20s",
            "vcenter_server": "{{user `vcenter_server`}}",
            "username": "{{user `username`}}",
            "password": "{{user `password`}}",
            "insecure_connection": "true",
            "vm_name": "{{user `vm_name`}}",
            "datastore": "{{user `datastore`}}",
            "folder": "{{user `folder`}}",
            "host": "{{user `host`}}",
            "convert_to_template": "true",
            "cluster": "{{user `cluster`}}",
            "network_adapters": [
                {
                    "network": "{{user `network`}}",
                    "network_card": "vmxnet3"
                }
            ],
            "boot_order": "disk,cdrom",
            "guest_os_type": "centos7_64Guest",
            "ssh_username": "{{user `ssh_name`}}",
            "ssh_password": "{{user `ssh_pass`}}",
            "ssh_port": 22,
            "ssh_timeout": "10000s",
            "CPUs": "{{user `num_cpus`}}",
            "RAM": "{{user `mem_size`}}",
            "disk_controller_type": "pvscsi",
            "storage": [
                {
                    "disk_size": "{{user `disk_size`}}",
                    "disk_thin_provisioned": true
                }
            ],
            "iso_urls": [
                "http://mirrors.melbourne.co.uk/centos/7.8.2003/isos/x86_64/{{user `iso_name`}}"
            ],
            "iso_checksum": "{{user `iso_checksum_type`}}:{{user `iso_checksum`}}",
            "floppy_files": [
                "{{user `http_directory`}}/{{user `kickstart`}}"
            ],
            "boot_command": [
                "<tab> text ks=hd:fd0:/{{user `kickstart`}}<enter><wait>"
            ]
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "scripts": [
                "../provisioners/base-7.sh",
                "../provisioners/kernel_stuff.sh",
                "../provisioners/tools.sh"
            ],
            "environment_vars": [
                "EPEL_RELEASE=epel-release"
            ]
        },
        {
            "type": "shell",
            "script": "../provisioners/full-clean.sh",
            "execute_command": "echo 'deploy' | {{.Vars}} sudo -E -S sh -ex '{{.Path}}'"
        }
    ],
    "post-processors": []
}